{
  "dataset_name": "wikistream_risk_scores",
  "description": "User risk scores and alerts from Gold layer for WikiStream pipeline. Contains evidence fields for alert investigation.",
  "data_source": {
    "type": "ATHENA",
    "catalog": "s3tablescatalog",
    "database": "s3tablesbucket.gold",
    "table": "risk_scores",
    "workgroup": "primary"
  },
  "physical_table": {
    "columns": [
      {"name": "stat_date", "type": "STRING", "description": "Date of analysis (YYYY-MM-DD)"},
      {"name": "entity_id", "type": "STRING", "description": "User identifier"},
      {"name": "entity_type", "type": "STRING", "description": "Entity type (user)"},
      {"name": "total_edits", "type": "INTEGER", "description": "Total edits by user"},
      {"name": "edits_per_hour_avg", "type": "DECIMAL", "description": "Average edits per hour"},
      {"name": "large_deletions", "type": "INTEGER", "description": "Count of large deletions"},
      {"name": "domains_edited", "type": "INTEGER", "description": "Number of domains edited"},
      {"name": "risk_score", "type": "DECIMAL", "description": "Computed risk score (0-100)"},
      {"name": "risk_level", "type": "STRING", "description": "Risk level: LOW, MEDIUM, HIGH"},
      {"name": "evidence", "type": "STRING", "description": "JSON evidence for alert investigation"},
      {"name": "alert_triggered", "type": "BOOLEAN", "description": "Whether alert was triggered"},
      {"name": "gold_processed_at", "type": "DATETIME", "description": "Processing timestamp"}
    ]
  },
  "logical_table": {
    "calculated_fields": [
      {
        "name": "datetime",
        "expression": "parseDate({stat_date}, 'yyyy-MM-dd')"
      },
      {
        "name": "is_high_risk",
        "expression": "ifelse({risk_level} = 'HIGH', 'Yes', 'No')"
      },
      {
        "name": "is_medium_or_high",
        "expression": "ifelse({risk_level} = 'HIGH' OR {risk_level} = 'MEDIUM', 'Yes', 'No')"
      },
      {
        "name": "risk_category",
        "expression": "ifelse({risk_score} >= 70, 'Critical', ifelse({risk_score} >= 40, 'Warning', 'Normal'))"
      }
    ],
    "filters": [],
    "data_transforms": []
  },
  "permissions": {
    "principals": ["arn:aws:quicksight:us-east-1:${account_id}:group/default/wikistream-analysts"],
    "actions": ["quicksight:DescribeDataSet", "quicksight:PassDataSet"]
  },
  "refresh_schedule": {
    "interval": "HOURLY",
    "start_after_datetime": "2024-01-01T00:00:00Z",
    "timezone": "UTC"
  }
}



